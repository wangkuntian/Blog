---
title: å†…æ ¸å‚æ•°ï¼šARP
published: 2025-12-11
description: ""
image: ""
tags: ["æ“ä½œç³»ç»Ÿ", "å†…æ ¸å‚æ•°"]
category: "æ“ä½œç³»ç»Ÿ"
draft: false
lang: ""
---

ä»¥ä¸‹æ˜¯å…³äº Linux å†…æ ¸ä¸­ ARP ç›¸å…³å‚æ•°çš„è¯¦ç»†è¯´æ˜ã€‚

# â€‹â€‹1. `arp_ignore` - ARP å“åº”æ§åˆ¶ â€‹â€‹

æ§åˆ¶å†…æ ¸å¦‚ä½•å“åº” â€‹**â€‹ æ¥æ”¶åˆ°çš„ ARP è¯·æ±‚ â€‹**â€‹ã€‚

| å€¼               | è¡Œä¸ºæè¿°                                                |
| ---------------- | ------------------------------------------------------- |
| â€‹**â€‹0â€‹**â€‹ (é»˜è®¤) | å“åº”æ‰€æœ‰æœ¬åœ°æ¥å£çš„ ARP è¯·æ±‚ï¼ˆå³ä½¿ç›®æ ‡ IP ä¸åœ¨å½“å‰æ¥å£ï¼‰ |
| â€‹**â€‹1â€‹**â€‹        | ä»…å½“ç›®æ ‡ IP æ˜¯ â€‹**â€‹ æ¥æ”¶æ¥å£é…ç½®çš„ IPâ€‹**â€‹ æ—¶æ‰å“åº”      |
| â€‹**â€‹2â€‹**â€‹        | åœ¨ "1" åŸºç¡€ä¸Šï¼Œè¿˜è¦æ±‚æº IP ä¸ç›®æ ‡ IP åœ¨åŒä¸€å­ç½‘         |
| â€‹**â€‹3â€‹**â€‹        | å“åº”ä¸»æœºæ‰€æœ‰æ¥å£çš„ ARPï¼Œä½†éœ€æº IP å’Œç›®æ ‡ IP åœ¨åŒä¸€å­ç½‘  |
| â€‹**â€‹4-7â€‹**â€‹      | ä¿ç•™å€¼ï¼Œè¡Œä¸ºç±»ä¼¼ "1"                                    |
| â€‹**â€‹8â€‹**â€‹        | ä¸å“åº”ä»»ä½• ARP è¯·æ±‚                                     |

> âœ… â€‹**â€‹ å…¸å‹ç”¨ä¾‹ â€‹**â€‹ï¼šåœ¨ Docker ä¸­è®¾ç½® `arp_ignore=1` å¯é˜²æ­¢å®¹å™¨é€šè¿‡é”™è¯¯æ¥å£å“åº” ARP

# â€‹â€‹2. `arp_announce` - ARP é€šå‘Šæ§åˆ¶ â€‹â€‹

æ§åˆ¶ â€‹**â€‹ å‘é€ ARP è¯·æ±‚ â€‹**â€‹ æ—¶ä½¿ç”¨çš„æº IPã€‚

| å€¼               | è¡Œä¸ºæè¿°                                   |
| ---------------- | ------------------------------------------ |
| â€‹**â€‹0â€‹**â€‹ (é»˜è®¤) | å¯ä½¿ç”¨ä»»ä½•æœ¬åœ° IP ä½œä¸ºæº IP                |
| â€‹**â€‹1â€‹**â€‹        | ä¼˜å…ˆé€‰æ‹©ä¸ç›®æ ‡ IP åœ¨åŒä¸€å­ç½‘çš„æœ¬åœ° IP      |
| â€‹**â€‹2â€‹**â€‹        | â€‹**â€‹ å¼ºåˆ¶ â€‹**â€‹ ä½¿ç”¨ä¸ç›®æ ‡æ¥å£ç›´æ¥å…³è”çš„ IP |

> âœ… â€‹**â€‹ å…¸å‹ç”¨ä¾‹ â€‹**â€‹ï¼šè®¾ç½® `arp_announce=2` å¯é¿å… ARP ç¼“å­˜æ±¡æŸ“

# â€‹â€‹3. `arp_filter` - ARP æºéªŒè¯ â€‹â€‹

æ§åˆ¶æ˜¯å¦è¿›è¡Œ â€‹**â€‹ARP æº IP éªŒè¯ â€‹**â€‹ã€‚

| å€¼               | è¡Œä¸ºæè¿°                          |
| ---------------- | --------------------------------- |
| â€‹**â€‹0â€‹**â€‹ (é»˜è®¤) | ä¸éªŒè¯å…¥ç«™ ARP åŒ…çš„æº IP          |
| â€‹**â€‹1â€‹**â€‹        | ä¸¥æ ¼æ£€æŸ¥æº IPï¼Œç¡®ä¿ä¸æ¥æ”¶æ¥å£åŒ¹é… |

> âœ… â€‹**â€‹ å…¸å‹ç”¨ä¾‹ â€‹**â€‹ï¼š`arp_filter=1` + `rp_filter=1` å¯æ„å»ºå¼º ARP é˜²å¾¡

# â€‹ å…¶ä»–é‡è¦ ARP å†…æ ¸å‚æ•° â€‹â€‹

é™¤ä¸Šè¿°å‚æ•°å¤–ï¼Œè¿˜æœ‰è¿™äº›å…³é”®å‚æ•°ï¼š

## ğŸ“Œ `proxy_arp` - ä»£ç† ARP

| å€¼        | è¡Œä¸º                            |
| --------- | ------------------------------- |
| â€‹**â€‹0â€‹**â€‹ | ç¦ç”¨ä»£ç† ARP                    |
| â€‹**â€‹1â€‹**â€‹ | å…è®¸æ¥å£å“åº”å…¶ä»–ä¸»æœºçš„ ARP è¯·æ±‚ |

```
echo 1 > /proc/sys/net/ipv4/conf/docker0/proxy_arp
```

## ğŸ“Œ `arp_notify` - ä¸»åŠ¨é€šå‘Š

| å€¼        | è¡Œä¸º                             |
| --------- | -------------------------------- |
| â€‹**â€‹0â€‹**â€‹ | ç¦ç”¨ä¸»åŠ¨ ARP é€šå‘Š                |
| â€‹**â€‹1â€‹**â€‹ | å½“æ¥å£çŠ¶æ€å˜åŒ–æ—¶è‡ªåŠ¨å‘é€å…è´¹ ARP |

## ğŸ“Œ `app_solicit` - ARP å®ˆæŠ¤è¿›ç¨‹æ¢æµ‹

```
# å½“ ARP ç¼“å­˜æœªå‘½ä¸­æ—¶ï¼Œå°è¯•è¯¢é—®ç”¨æˆ·ç©ºé—´å®ˆæŠ¤è¿›ç¨‹çš„æ¬¡æ•°
echo 3 > /proc/sys/net/ipv4/neigh/docker0/app_solicit
```

## ğŸ“Œ `locktime` - ARP è®°å½•é”å®š

```
# ARP è®°å½•åœ¨ç¼“å­˜ä¸­çš„æœ€çŸ­ä¿ç•™æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
echo 1000 > /proc/sys/net/ipv4/neigh/docker0/locktime
```

## ğŸ“Œ `base_reachable_time` - è®°å½•æœ‰æ•ˆæœŸ

```
# æˆåŠŸæ¥æ”¶ ARP å“åº”åè®°å½•çš„æœ‰æ•ˆæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
echo 30000 > /proc/sys/net/ipv4/neigh/docker0/base_reachable_time
```

---

# â€‹ ç‰¹æ®Šæ¥å£å‚æ•° â€‹â€‹

è¿™äº›å‚æ•°å¯é’ˆå¯¹ç‰¹å®šæ¥å£è®¾ç½®ï¼ˆå¦‚ `docker0`, `eth0`ï¼‰ï¼š

## ğŸ”§ `mcast_solicit` - å¤šæ’­è¯·æ±‚æ¬¡æ•°

```
# ARP è§£æå¤±è´¥æ—¶å‘é€å¤šæ’­è¯·æ±‚çš„æ¬¡æ•°
echo 5 > /proc/sys/net/ipv4/neigh/docker0/mcast_solicit
```

## ğŸ”§ `ucast_solicit` - å•æ’­æ¢æµ‹æ¬¡æ•°

```
# å½“ ARP è¡¨ä¸­æœ‰æ—§è®°å½•æ—¶å°è¯•å•æ’­æ¢æµ‹çš„æ¬¡æ•°
echo 3 > /proc/sys/net/ipv4/neigh/docker0/ucast_solicit
```

## ğŸ”§ `gc_thresh` - ARP åƒåœ¾å›æ”¶

```
# ARP ç¼“å­˜è¡¨çš„æœ€å¤§æ¡ç›®æ•°
echo 16384 > /proc/sys/net/ipv4/neigh/docker0/gc_thresh3
```

# â€‹â€‹ ç»¼åˆåº”ç”¨ç¤ºä¾‹ â€‹â€‹

åœ¨ Docker æ¡¥æ¥ç½‘ç»œä¸Šå®ç° ARP éš”ç¦»ï¼š

```
# è¿›å…¥å®¹å™¨ç½‘ç»œå‘½åç©ºé—´
sudo nsenter -t $(docker inspect -f '{{.State.Pid}}' <å®¹å™¨ID>) -n bash

# è®¾ç½®å®¹å™¨æ¥å£çš„ ARP ç­–ç•¥
echo 1 > /proc/sys/net/ipv4/conf/eth0/arp_ignore
echo 2 > /proc/sys/net/ipv4/conf/eth0/arp_announce
echo 1 > /proc/sys/net/ipv4/conf/eth0/rp_filter  # å¯ç”¨åå‘è·¯å¾„éªŒè¯
```

---

## â€‹ å‚æ•°å…³è”è¡¨ â€‹â€‹

| å‚æ•°             | å½±å“æ–¹å‘ | é˜²å¾¡èƒ½åŠ›           |
| ---------------- | -------- | ------------------ |
| `arp_ignore=1`   | å…¥ç«™     | ğŸ›¡ï¸ é˜² ARP æ¬ºéª—     |
| `arp_announce=2` | å‡ºç«™     | ğŸ›¡ï¸ é˜² ARP ç¼“å­˜æŠ•æ¯’ |
| `arp_filter=1`   | åŒå‘     | ğŸ›¡ï¸ é˜² IP åœ°å€ä¼ªé€   |
| `proxy_arp=0`    | å…¥ç«™     | ğŸ”‡ ç¦ç”¨ä¸å®‰å…¨ä»£ç†  |

> âš ï¸ â€‹**â€‹ æ³¨æ„ â€‹**â€‹ï¼šè¿‡åº¦é™åˆ¶å¯èƒ½å¯¼è‡´ç½‘ç»œä¸­æ–­ï¼Œå»ºè®®åœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯åå†åº”ç”¨
