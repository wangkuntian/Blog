---
title: 网络传输
published: 2025-12-12
description: ""
image: ""
tags: ["网络", "网络基础"]
category: "网络"
draft: false
lang: ""
---

在一个完整的网络访问过程中，数据包的格式会经历多个层次的封装和解封装。这个过程通常遵循 OSI 模型（开放系统互联模型）或 TCP/IP 模型，下面我们详细分析一下每一层数据格式的变化。

# 网络访问过程

当一个用户发起网络访问请求时，数据从应用层开始，经过传输层、网络层、数据链路层，最终到达物理层，进行传输到远程设备。在接收方，数据按相反顺序逐层解封装，恢复到应用层的数据格式。

## 1. 应用层 (Application Layer)

-   **数据内容**: 这一层处理的是用户与网络之间的交互。它包含了从应用程序（如浏览器、电子邮件客户端等）传来的数据。
-   **数据格式**: 应用层的内容通常是“原始数据”，例如一个 HTTP 请求、一个 DNS 查询等。例如：
    -   HTTP 请求可能是一个文本格式的字符串，如：
        ```
        GET /index.html HTTP/1.1
        Host: www.example.com
        ```
-   **封装**: 此时的数据没有任何网络层的信息，仅仅是应用程序生成的内容。

## 2. 传输层 (Transport Layer)

-   **协议**: 这一层主要通过传输协议来实现端对端通信。常见的协议是 **TCP**（传输控制协议）和 **UDP**（用户数据报协议）。
-   **封装过程**:
    -   **TCP**：当数据通过 TCP 传输时，它会被封装为一个 **段（Segment）**。每个段包含一些控制信息，如源端口、目标端口、序列号、确认号、窗口大小、校验和等，确保数据的可靠传输。
    -   **UDP**：UDP 比较简单，数据封装为 **数据报（Datagram）**，包含源端口、目标端口、长度和校验和等字段，但没有像 TCP 那样的序列号或确认号。
-   **TCP 段格式**：
    -   **源端口**: 发起连接的端口号。
    -   **目标端口**: 接收方的端口号。
    -   **序列号**: 用于追踪数据的顺序。
    -   **确认号**: 用于确认接收到的数据。
    -   **数据**: 从应用层传递的数据。
    -   **标志位**: 如 SYN、ACK、FIN 等，用于控制连接。
    -   **校验和**: 用于错误检查。
-   **UDP 数据报格式**：
    -   **源端口**
    -   **目标端口**
    -   **长度**：数据的长度。
    -   **校验和**
    -   **数据**：从应用层传来的数据。

## 3. 网络层 (Network Layer)

-   **协议**: 主要是 **IP 协议**，包括 IPv4 和 IPv6。
-   **封装过程**: 传输层的数据会被封装成 **包（Packet）**，每个包包含 **IP 头部**，它包括源 IP 地址、目标 IP 地址和其他控制信息。该层负责选择数据的路径。
-   **IP 包格式**：
    -   **版本**: 指定 IP 协议的版本（IPv4 或 IPv6）。
    -   **头部长度**: IP 头部的长度。
    -   **源 IP 地址**: 发送方的 IP 地址。
    -   **目标 IP 地址**: 接收方的 IP 地址。
    -   **协议**: 指明使用的传输层协议（如 TCP 或 UDP）。
    -   **TTL（Time-to-Live）**: 数据包的生命周期，防止数据包在网络中永远存在。
    -   **校验和**: 用于检测头部的错误。
    -   **数据**: 传输层的数据（即 TCP 段或 UDP 数据报）。

## 4. 数据链路层 (Data Link Layer)

-   **协议**: 数据链路层主要包括以太网协议（Ethernet）、Wi-Fi 等，负责在同一网络中直接通信。
-   **封装过程**: 这一层将 IP 包封装为 **帧（Frame）**。每个帧都包含源和目标的硬件地址（MAC 地址），并可能包含一些控制信息，如帧校验序列（FCS）。
-   **以太网帧格式**：
    -   **目标 MAC 地址**: 接收方的 MAC 地址。
    -   **源 MAC 地址**: 发送方的 MAC 地址。
    -   **类型**: 指定上层协议（如 IPv4）。
    -   **数据**: 网络层传来的 IP 包。
    -   **帧校验序列（FCS）**: 用于错误检测。

## 5. 物理层 (Physical Layer)

-   **协议**: 物理层负责数据的实际传输，通常通过电信号、光信号或无线电波的形式传输数据。
-   **封装过程**: 在这一层，数据被转换成比特流，按照电压或无线信号传输。物理层不涉及数据包的格式，它仅仅负责比特的传输。
-   **传输方式**:
    -   在有线网络中，物理层的信号通常是电信号或光信号。
    -   在无线网络中，信号以无线电波的形式传输。

## 6. 接收方的数据解封装

-   **物理层**: 接收到的信号会被转换为比特流，传输到上层。
-   **数据链路层**: 数据链路层会根据帧头的目标 MAC 地址识别是否是目标设备的帧，并去掉帧头，传递给网络层。
-   **网络层**: 网络层会检查 IP 头并去掉，传递给传输层。
-   **传输层**: 传输层会检查 TCP 或 UDP 头部，确定数据包的完整性和顺序，最后将应用层数据交给应用程序。

# 数据流的示例

假设用户在浏览器中输入一个网址：

1. **应用层**: 浏览器发送一个 HTTP GET 请求。
2. **传输层**: HTTP 请求被封装成一个 TCP 段，包含源端口、目标端口、序列号等。
3. **网络层**: TCP 段被封装为一个 IP 包，包含源 IP、目标 IP 等。
4. **数据链路层**: IP 包被封装为以太网帧，添加源 MAC 地址和目标 MAC 地址。
5. **物理层**: 以太网帧转化为比特流，通过网络传输。

# 总结

数据在网络中流动的过程中会逐层被封装和解封装，每一层的头部（如 TCP 头、IP 头、MAC 头等）为数据传输提供了所需的控制信息。这个封装和解封装的过程确保了数据能顺利从源设备到达目标设备，同时可以处理网络中的错误、路由、传输可靠性等问题。

![](images/network.png)
